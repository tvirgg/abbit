# Project Directory Structure

üìÅ ./
  üìÑ Abbit_Seed.xlsx
  üìÑ README.md
  üìÑ p.py


# File Contents

File: Abbit_Seed.xlsx
================================================================================
--- Sheet: sheet1.xml ---
id	name	email	country_id	gpa	ielts_score	selected_program_ids
1	–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤	ivan@mail.com	at	4.5	6.5	1001, 1002
2	–ê–Ω–Ω–∞ –ü–µ—Ç—Ä–æ–≤–∞	anna.pet@domain.com	it	4.2	7	1002
3	–î–º–∏—Ç—Ä–∏–π –°–º–∏—Ä–Ω–æ–≤	dmitry@ex.com	at	4.9	7.5	1001

--- Sheet: sheet2.xml ---
id	name	flag_icon
at	–ê–≤—Å—Ç—Ä–∏—è	üá¶üáπ
it	–ò—Ç–∞–ª–∏—è	üáÆüáπ
de	–ì–µ—Ä–º–∞–Ω–∏—è	üá©üá™

--- Sheet: sheet3.xml ---
id	name	logo_url	country_id
tu_wien	–í–µ–Ω—Å–∫–∏–π –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç	üéì	at
unibo	–ë–æ–ª–æ–Ω—Å–∫–∏–π –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç	üèõÔ∏è	it
tu_munich	–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –ú—é–Ω—Ö–µ–Ω–∞	üéì	de

--- Sheet: sheet4.xml ---
id	title	university_id	deadline	link	required_document_ids	degree	tuition_fee	duration	language_reqs	description
1001	–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞	tu_wien	01.03.2026	https://tuwien.at/arch	501, 502	Bachelor	1500 EUR / –≥–æ–¥	3 –≥–æ–¥–∞	IELTS 6.0	–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã ¬´–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞¬ª.
1002	–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞	unibo	15.04.2026	https://www.unibo.it/it	101, 201	Bachelor	1500 EUR / –≥–æ–¥	3 –≥–æ–¥–∞	IELTS 6.0	–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã ¬´–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞¬ª.
1003	–ú–∞—à–∏–Ω–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ	tu_munich	30.04.2026	https://www.tum.de	101, 402	Master	1500 EUR / –≥–æ–¥	3 –≥–æ–¥–∞	IELTS 6.0	–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã ¬´–ú–∞—à–∏–Ω–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ¬ª.

--- Sheet: sheet5.xml ---
id	category	title	allowed_extensions
101	–õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ	–°–∫–∞–Ω –∑–∞–≥—Ä–∞–Ω–ø–∞—Å–ø–æ—Ä—Ç–∞	.pdf, .jpg
201	–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ	–ê—Ç—Ç–µ—Å—Ç–∞—Ç (—à–∫–æ–ª–∞)	.pdf
402	–≠–∫–∑–∞–º–µ–Ω—ã	–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç TOLC-I	.pdf, .jpg, .png
501	–¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ	–ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ	.pdf
502	–¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ	–ú–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω–æ–µ –ø–∏—Å—å–º–æ	.pdf

--- Sheet: sheet6.xml ---
id	target_country_ids	title	xp	deadline	description	advice	links_to_document_id	submission_type	stage
1	at, it	–°–æ–∑–¥–∞—Ç—å –ø–æ—á—Ç—É	20	01.11.2025	–ó–∞–≤–µ–¥–∏—Ç–µ Google Mail.	–§–æ—Ä–º–∞—Ç: –∏–º—è.—Ñ–∞–º–∏–ª–∏—è	credentials	–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
21	it	–°–¥–∞—Ç—å TOLC-I	100	20.02.2026	–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ Cisia.	–ì–æ—Ç–æ–≤—å—Ç–µ—Å—å –∑–∞—Ä–∞–Ω–µ–µ.	402	upload	–≠–∫–∑–∞–º–µ–Ω—ã

--------------------------------------------------------------------------------

File: README.md
================================================================================
# abbit
 
# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Abbit (Excel)

–≠—Ç–æ—Ç —Ñ–∞–π–ª –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É Excel-—Ñ–∞–π–ª–∞ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö. –§–∞–π–ª –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å **6 –≤–∫–ª–∞–¥–æ–∫** —Å –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–µ.

## ‚ö†Ô∏è –û–±—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞
1.  **–§–æ—Ä–º–∞—Ç –¥–∞—Ç:** –°—Ç—Ä–æ–≥–æ **–î–î.–ú–ú.–ì–ì–ì–ì** (–Ω–∞–ø—Ä–∏–º–µ—Ä: `25.12.2025`).
2.  **–°–ø–∏—Å–∫–∏:** –ï—Å–ª–∏ –≤ —è—á–µ–π–∫–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–Ω–∞—á–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, ID –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤), —Ä–∞–∑–¥–µ–ª—è–π—Ç–µ –∏—Ö **–∑–∞–ø—è—Ç–æ–π** (–Ω–∞–ø—Ä–∏–º–µ—Ä: `101, 202`).
3.  **–°—Å—ã–ª–∫–∏:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–æ—Ä–º–∞—Ç `https://–∞–¥—Ä–µ—Å.com`.
4.  **–¢–µ–∫—Å—Ç–æ–≤—ã–µ ID:** –ö–æ–¥—ã —Å—Ç—Ä–∞–Ω –∏ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤ –ø–∏—à—É—Ç—Å—è –ª–∞—Ç–∏–Ω–∏—Ü–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä: `at`, `tu_wien`).

---

## –õ–∏—Å—Ç 1: **Countries**
–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Å—Ç—Ä–∞–Ω. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ –≤—É–∑–æ–≤ –∏ –∑–∞–¥–∞—á.

| id | name | flag_icon |
| :--- | :--- | :--- |
| at | –ê–≤—Å—Ç—Ä–∏—è | üá¶üáπ |
| it | –ò—Ç–∞–ª–∏—è | üáÆüáπ |

*   **id (–¢–µ–∫—Å—Ç)**: –ö–æ–¥ —Å—Ç—Ä–∞–Ω—ã (2 –±—É–∫–≤—ã). –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: `at`, `it`, `de`, `us`, `uk`, `fr`.
*   **name (–¢–µ–∫—Å—Ç)**: –ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω—ã.
*   **flag_icon (–¢–µ–∫—Å—Ç)**: –≠–º–æ–¥–∑–∏ —Ñ–ª–∞–≥–∞.

---

## –õ–∏—Å—Ç 2: **Universities**
–°–ø–∏—Å–æ–∫ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤.

| id | name | logo_url | country_id |
| :--- | :--- | :--- | :--- |
| tu_wien | –í–µ–Ω—Å–∫–∏–π –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π | üéì | at |
| unibo | –ë–æ–ª–æ–Ω—Å–∫–∏–π –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç | üèõÔ∏è | it |

*   **id (–¢–µ–∫—Å—Ç)**: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥ –≤—É–∑–∞ (–ª–∞—Ç–∏–Ω–∏—Ü–∞, –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤).
*   **name (–¢–µ–∫—Å—Ç)**: –ü–æ–ª–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ.
*   **logo_url (–¢–µ–∫—Å—Ç)**: –≠–º–æ–¥–∑–∏ –∏–ª–∏ —Å—Å—ã–ª–∫–∞ –Ω–∞ –ª–æ–≥–æ—Ç–∏–ø.
*   **country_id (–¢–µ–∫—Å—Ç)**: –ö–æ–¥ —Å—Ç—Ä–∞–Ω—ã –∏–∑ –≤–∫–ª–∞–¥–∫–∏ **Countries** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `at`).

---

## –õ–∏—Å—Ç 3: **Programs**
–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—á–µ–±–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º–∞—Ö.

| id | title | degree | tuition_fee | duration | language_reqs | description | university_id | deadline | link | required_document_ids |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| 1001 | –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ | Bachelor | 1500‚Ç¨ / –≥–æ–¥ | 3 –≥–æ–¥–∞ | IELTS 6.0 | –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã... | tu_wien | 01.03.2026 | https://... | 501, 502 |

*   **id (–ß–∏—Å–ª–æ)**: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä –ø—Ä–æ–≥—Ä–∞–º–º—ã.
*   **title (–¢–µ–∫—Å—Ç)**: –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã (–±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è —Å—Ç–µ–ø–µ–Ω–∏). –ü—Ä–∏–º–µ—Ä: "–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞".
*   **degree (–¢–µ–∫—Å—Ç)**: –°—Ç–µ–ø–µ–Ω—å. –°—Ç—Ä–æ–≥–æ –æ–¥–Ω–æ –∏–∑: `Bachelor`, `Master`, `Foundation`, `PhD`.
*   **tuition_fee (–¢–µ–∫—Å—Ç)**: –°—Ç–æ–∏–º–æ—Å—Ç—å –æ–±—É—á–µ–Ω–∏—è. –ü—Ä–∏–º–µ—Ä: "1500 EUR / year".
*   **duration (–¢–µ–∫—Å—Ç)**: –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å. –ü—Ä–∏–º–µ—Ä: "3 years" –∏–ª–∏ "4 —Å–µ–º–µ—Å—Ç—Ä–∞".
*   **language_reqs (–¢–µ–∫—Å—Ç)**: –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —è–∑—ã–∫—É. –ü—Ä–∏–º–µ—Ä: "IELTS 6.5, German B2".
*   **description (–¢–µ–∫—Å—Ç)**: –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã.
*   **university_id (–¢–µ–∫—Å—Ç)**: –ö–æ–¥ –≤—É–∑–∞ –∏–∑ –≤–∫–ª–∞–¥–∫–∏ **Universities**.
*   **deadline (–î–∞—Ç–∞)**: –°—Ä–æ–∫ –ø–æ–¥–∞—á–∏ (–î–î.–ú–ú.–ì–ì–ì–ì).
*   **link (–¢–µ–∫—Å—Ç)**: –°—Å—ã–ª–∫–∞ –Ω–∞ —Å–∞–π—Ç –ø—Ä–æ–≥—Ä–∞–º–º—ã.
*   **required_document_ids (–¢–µ–∫—Å—Ç)**: ID –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏–∑ –≤–∫–ª–∞–¥–∫–∏ **Documents** —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é.

---

## –õ–∏—Å—Ç 4: **Documents**
–¢–∏–ø—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç —Å—Ç—É–¥–µ–Ω—Ç—ã.

| id | category | title | allowed_extensions |
| :--- | :--- | :--- | :--- |
| 101 | –õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ | –ü–∞—Å–ø–æ—Ä—Ç | .pdf, .jpg |

*   **id (–ß–∏—Å–ª–æ)**: –ù–æ–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞.
*   **category (–¢–µ–∫—Å—Ç)**: –ö–∞—Ç–µ–≥–æ—Ä–∏—è (–¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏).
*   **title (–¢–µ–∫—Å—Ç)**: –ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞.
*   **allowed_extensions (–¢–µ–∫—Å—Ç)**: –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä: `.pdf, .jpg`).

---

## –õ–∏—Å—Ç 5: **Quests**
–ó–∞–¥–∞—á–∏ (Task Templates) –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤.

| id | target_country_ids | stage | title | xp | deadline | description | advice | links_to_document_id | submission_type |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| 1 | at, it | –í–∏–∑–∞ | –°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ | 20 | 01.11.2025 | –°—Ö–æ–¥–∏—Ç–µ –≤ –∞—Ç–µ–ª—å–µ | –§–æ–Ω –±–µ–ª—ã–π, –±–µ–∑ –æ—á–∫–æ–≤ | | file |

*   **id (–ß–∏—Å–ª–æ)**: –ù–æ–º–µ—Ä –∑–∞–¥–∞—á–∏.
*   **target_country_ids (–¢–µ–∫—Å—Ç)**: –ö–æ–¥—ã —Å—Ç—Ä–∞–Ω (`at`, `de`...), –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö –∑–∞–¥–∞—á–∞ –∞–∫—Ç—É–∞–ª—å–Ω–∞. –ï—Å–ª–∏ –ø—É—Å—Ç–æ ‚Äî –∑–∞–¥–∞—á–∞ –¥–ª—è –≤—Å–µ—Ö.
*   **stage (–¢–µ–∫—Å—Ç)**: –≠—Ç–∞–ø –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è. **–°—Ç—Ä–æ–≥–æ –æ–¥–Ω–æ –∏–∑:** `–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞`, `–î–æ–∫—É–º–µ–Ω—Ç—ã`, `–í–∏–∑–∞`, `–≠–∫–∑–∞–º–µ–Ω—ã`, `–§–∏–Ω–∞–Ω—Å—ã`, `–†–∞–∑–º–µ—â–µ–Ω–∏–µ`, `–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è`.
*   **title (–¢–µ–∫—Å—Ç)**: –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∑–∞–¥–∞—á–∏.
*   **xp (–ß–∏—Å–ª–æ)**: –ù–∞–≥—Ä–∞–¥–∞ (–æ–ø—ã—Ç).
*   **deadline (–î–∞—Ç–∞)**: –î–µ–¥–ª–∞–π–Ω –∑–∞–¥–∞—á–∏ (–î–î.–ú–ú.–ì–ì–ì–ì).
*   **description (–¢–µ–∫—Å—Ç)**: –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å.
*   **advice (–¢–µ–∫—Å—Ç)**: –ü–æ–ª–µ–∑–Ω—ã–π —Å–æ–≤–µ—Ç –∏–ª–∏ –ø–æ–¥—Å–∫–∞–∑–∫–∞.
*   **links_to_document_id (–ß–∏—Å–ª–æ)**: –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ —Ç—Ä–µ–±—É–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –µ–≥–æ ID (–∏–∑ –≤–∫–ª–∞–¥–∫–∏ **Documents**).
*   **submission_type (–¢–µ–∫—Å—Ç)**: –¢–∏–ø –æ—Ç–≤–µ—Ç–∞. **–°—Ç—Ä–æ–≥–æ –æ–¥–Ω–æ –∏–∑:**
    *   `file` ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞.
    *   `text` ‚Äî —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç.
    *   `link` ‚Äî —Å—Å—ã–ª–∫–∞.
    *   `credentials` ‚Äî –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å.
    *   `none` ‚Äî –ø—Ä–æ—Å—Ç–æ –≥–∞–ª–æ—á–∫–∞ "–°–¥–µ–ª–∞–Ω–æ".

---

## –õ–∏—Å—Ç 6: **Students**
–°–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–æ–≤.

| id | name | email | country_id | gpa | ielts_score | selected_program_ids |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| 1 | –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤ | user@mail.com | at | 4.5 | 6.5 | 1001, 1002 |

--------------------------------------------------------------------------------

File: p.py
================================================================================
import os
import zipfile
import xml.etree.ElementTree as ET

# –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏—Å–∫–ª—é—á–∞–µ–º—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
EXCLUDE_DIRS = ['node_modules', '.git', 'dist', '.next']
EXCEL_EXTENSIONS = ('.xlsx', '.xlsm', '.xltx', '.xltm')
EXCLUDE_FILES = {'.DS_Store'}

def is_binary_file(file_path, sample_size=1024):
    """
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ñ–∞–π–ª –±–∏–Ω–∞—Ä–Ω—ã–º –ø–æ –Ω–∞–ª–∏—á–∏—é –Ω—É–ª–µ–≤—ã—Ö –±–∞–π—Ç–æ–≤ –≤ –Ω–∞—á–∞–ª–µ.
    """
    try:
        with open(file_path, 'rb') as file:
            chunk = file.read(sample_size)
            return b'\x00' in chunk
    except Exception:
        return True


def read_excel_file(file_path):
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ Excel-—Ñ–∞–π–ª–∞ (OOXML: xlsx/xltx/...).
    """
    ns = {'x': 'http://schemas.openxmlformats.org/spreadsheetml/2006/main'}
    lines = []

    with zipfile.ZipFile(file_path, 'r') as zf:
        # –ß–∏—Ç–∞–µ–º sharedStrings (–µ—Å–ª–∏ –µ—Å—Ç—å)
        shared_strings = []
        if 'xl/sharedStrings.xml' in zf.namelist():
            root = ET.fromstring(zf.read('xl/sharedStrings.xml'))
            for si in root.findall('x:si', ns):
                chunks = [t.text or '' for t in si.findall('.//x:t', ns)]
                shared_strings.append(''.join(chunks))

        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∏–º–µ–Ω–∞ –ª–∏—Å—Ç–æ–≤
        sheet_names = {}
        if 'xl/workbook.xml' in zf.namelist():
            wb_root = ET.fromstring(zf.read('xl/workbook.xml'))
            rel_ns = {'r': 'http://schemas.openxmlformats.org/officeDocument/2006/relationships'}
            for sheet in wb_root.findall('.//x:sheets/x:sheet', ns):
                rel_id = sheet.attrib.get('{http://schemas.openxmlformats.org/officeDocument/2006/relationships}id')
                if rel_id:
                    sheet_names[rel_id] = sheet.attrib.get('name', rel_id)

            rels_path = 'xl/_rels/workbook.xml.rels'
            rel_map = {}
            if rels_path in zf.namelist():
                rel_root = ET.fromstring(zf.read(rels_path))
                for rel in rel_root.findall('{http://schemas.openxmlformats.org/package/2006/relationships}Relationship'):
                    rid = rel.attrib.get('Id')
                    target = rel.attrib.get('Target', '')
                    if rid and target:
                        rel_map[rid] = 'xl/' + target.lstrip('/')

            ordered_sheets = []
            for rid, name in sheet_names.items():
                sheet_path = rel_map.get(rid)
                if sheet_path and sheet_path in zf.namelist():
                    ordered_sheets.append((name, sheet_path))
        else:
            ordered_sheets = []

        # fallback: –µ—Å–ª–∏ workbook.xml –Ω–µ —Ä–∞–∑–æ–±—Ä–∞–ª–∏, —á–∏—Ç–∞–µ–º –≤—Å–µ sheet*.xml
        if not ordered_sheets:
            ordered_sheets = []
            for name in sorted(zf.namelist()):
                if name.startswith('xl/worksheets/sheet') and name.endswith('.xml'):
                    ordered_sheets.append((os.path.basename(name), name))

        for sheet_name, sheet_path in ordered_sheets:
            lines.append(f'--- Sheet: {sheet_name} ---')
            sheet_root = ET.fromstring(zf.read(sheet_path))

            row_count = 0
            for row in sheet_root.findall('.//x:sheetData/x:row', ns):
                values = []
                for cell in row.findall('x:c', ns):
                    cell_type = cell.attrib.get('t')
                    v = cell.find('x:v', ns)
                    text = ''
                    if cell_type == 's' and v is not None and v.text is not None:
                        idx = int(v.text)
                        if 0 <= idx < len(shared_strings):
                            text = shared_strings[idx]
                    elif cell_type == 'inlineStr':
                        is_node = cell.find('x:is', ns)
                        if is_node is not None:
                            text_parts = [t.text or '' for t in is_node.findall('.//x:t', ns)]
                            text = ''.join(text_parts)
                    elif v is not None and v.text is not None:
                        text = v.text
                    values.append(text)

                if any(val != '' for val in values):
                    lines.append('\t'.join(values))
                    row_count += 1

            if row_count == 0:
                lines.append('[–õ–∏—Å—Ç –ø—É—Å—Ç–æ–π]')
            lines.append('')

    return '\n'.join(lines).strip()


def generate_directory_tree(start_path, output_file, output_filename, exclude_dirs=None):
    """
    –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–µ—Ä–µ–≤–æ –∫–∞—Ç–∞–ª–æ–≥–æ–≤ –∏ –ø–∏—à–µ—Ç –µ–≥–æ –≤ –≤—ã—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª.
    """
    if exclude_dirs is None:
        exclude_dirs = EXCLUDE_DIRS

    output_file.write("# Project Directory Structure\n\n")

    for root, dirs, files in os.walk(start_path):
        # –ò—Å–∫–ª—é—á–∞–µ–º –Ω–µ–Ω—É–∂–Ω—ã–µ –ø–∞–ø–∫–∏
        dirs[:] = [d for d in dirs if d not in exclude_dirs]

        # –£—Ä–æ–≤–µ–Ω—å –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏
        level = root.replace(start_path, '').count(os.sep)
        indent = '  ' * level

        # –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å
        rel_path = os.path.relpath(root, start_path)
        if rel_path == '.':
            output_file.write(f"{indent}üìÅ ./\n")
        else:
            dir_name = os.path.basename(root)
            output_file.write(f"{indent}üìÅ {dir_name}/\n")

        # –§–∞–π–ª—ã
        sub_indent = '  ' * (level + 1)
        for file in sorted(files):
            if file == output_filename or file in EXCLUDE_FILES:
                continue
            output_file.write(f"{sub_indent}üìÑ {file}\n")

    output_file.write("\n\n# File Contents\n\n")


def main():
    # –¢–µ–∫—É—â–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è
    current_directory = os.getcwd()

    # –ò–º—è –≤—ã—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
    output_filename = 'files_with_code.txt'

    with open(output_filename, 'w', encoding='utf-8') as output:
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–µ—Ä–µ–≤–æ –∫–∞—Ç–∞–ª–æ–≥–æ–≤
        generate_directory_tree(current_directory, output, output_filename, EXCLUDE_DIRS)

        # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–æ–≤
        for root, dirs, files in os.walk(current_directory):
            # –ò—Å–∫–ª—é—á–∞–µ–º –Ω–µ–Ω—É–∂–Ω—ã–µ –ø–∞–ø–∫–∏
            dirs[:] = [d for d in dirs if d not in EXCLUDE_DIRS]

            for filename in files:
                if filename == output_filename or filename in EXCLUDE_FILES:
                    continue

                # –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å
                rel_path = os.path.relpath(os.path.join(root, filename), current_directory)
                file_path = os.path.join(root, filename)

                # –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ñ–∞–π–ª–∞
                output.write(f'File: {rel_path}\n')
                output.write('=' * 80 + '\n')

                try:
                    if filename.lower().endswith(EXCEL_EXTENSIONS):
                        excel_content = read_excel_file(file_path)
                        output.write(excel_content + '\n\n')
                        output.write('-' * 80 + '\n\n')
                        continue

                    if is_binary_file(file_path):
                        size = os.path.getsize(file_path)
                        output.write(f'[–ë–∏–Ω–∞—Ä–Ω—ã–π —Ñ–∞–π–ª, —Ä–∞–∑–º–µ—Ä: {size} –±–∞–π—Ç]\n\n')
                        output.write('-' * 80 + '\n\n')
                        continue

                    with open(file_path, 'r', encoding='utf-8') as file:
                        code = file.read()
                        output.write(code + '\n\n')
                        output.write('-' * 80 + '\n\n')
                except Exception as e:
                    output.write(f'–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª {rel_path}: {e}\n\n')
                    output.write('-' * 80 + '\n\n')

    print(f'–î–µ—Ä–µ–≤–æ –∫–∞—Ç–∞–ª–æ–≥–æ–≤ –∏ –∫–æ–¥ —Ñ–∞–π–ª–æ–≤ –∑–∞–ø–∏—Å–∞–Ω—ã –≤ {output_filename}')


if __name__ == "__main__":
    main()


--------------------------------------------------------------------------------

